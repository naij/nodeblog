KISSY.add("app/views/manage/picture/list",function(t,a,e,i,n,r,l,s){var d=r.all;return function(t){return t.prototype.template='<div class="wrap-hd clearfix"> <div class=title-bar> <h2 class=title>\u56fe\u7247\u5217\u8868</h2> </div> </div> <div class=table-container> <div class="toolbar clearfix"> <a href="#" class="btn btn-size25" mx-click=add>\u4e0a\u4f20\u56fe\u7247</a> <div class=table-settings> <a class="btn btn-size25" id=J_calendar href="#" bx-tmpl="calendar" bx-datakey="startTime,endTime"> {{startTime}} \u81f3 {{endTime}} </a> </div> </div> <table class="table pic-list" bx-name="tables" bx-tmpl="list" bx-datakey="list,pathPrefix"> <thead> <tr {{^list}}class=no-data{{/list}}> <th class=left width=120>\u56fe\u7247\u9884\u89c8</th> <th class=left>\u56fe\u7247\u5730\u5740</th> <th class=left width=100>\u56fe\u7247\u5c3a\u5bf8</th> <th class=left width=100>\u4e0a\u4f20\u65f6\u95f4</th> </tr> </thead> <tbody> {{#list}} <tr> <td class=left> <div class=pic-cnt> <a href="{{pathPrefix}}{{picPath}}" target=_blank><img src="{{pathPrefix}}{{picPath}}!120"  /></a> </div> </td> <td class=left> <textarea class=textarea onclick="select()">{{pathPrefix}}{{picPath}}</textarea> </td> <td class=left>{{picSize}}</td> <td class=left>{{uploadTime}}</td> </tr> {{/list}} {{^list}} <tr class=none> <td colspan=4> \u6682\u65e0\u6570\u636e </td> </tr> {{/list}} </tbody> </table> </div>',t}(a.extend({init:function(){var t=this;t.on("destroy",function(){var a=t.getManaged("calendar");a.destructor()})},locationChange:function(){this.render()},render:function(){var a=this,i=a.location,n=t.clone(i.params),r=n.startTime,s=n.endTime;r&&s?(r=l.dateParse(r),s=l.dateParse(s)):(r=l.dateRecent(-6),s=l.dateRecent(0)),a.manage("startTime",r),a.manage("endTime",s),a.manage(e.fetchAll([{name:"picture_list",urlParams:{startTime:r,endTime:s}}],function(t,e){var i=e.get("data");a.setViewPagelet({list:i.list,startTime:l.dateFormat(r),endTime:l.dateFormat(s),pathPrefix:i.pathPrefix},function(){a.components()})}))},components:function(){var t=this,a=(t.getManaged("pagelet"),t.getManaged("startTime")),e=t.getManaged("endTime"),i=new s({maxDate:new Date,trigger:"#J_calendar",align:{points:["br","tr"],offset:[0,0]},pages:2,rangeSelect:!0,popup:!0,triggerType:["click"],range:{start:a,end:e},autoRender:!1});i.on("rangeSelect",function(a){i.hide();var e=s.Date.format(a.start,"yyyy-mm-dd"),n=s.Date.format(a.end,"yyyy-mm-dd");t.navigate("startTime="+e+"&endTime="+n)}),t.manage("calendar",i)},"add<click>":function(t){t.halt();var a=this,e=d("#"+t.currentId).parent(".toolbar").offset().top,i=l.getDefaultDialogConfig({width:620,top:e}),n="app/views/manage/picture/add",r={callback:function(){a.render()}};l.showDialog(i,n,r)}}))},{requires:["mxext/view","app/models/modelmanager","magix/vom","magix/router","node","app/util/util","brix/gallery/calendar/index"]});