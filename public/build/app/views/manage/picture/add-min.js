KISSY.add("app/views/manage/picture/add",function(e,t,a,n,i,o,r){var d=o.all;return t.extend({init:function(e){this.manage("data",e)},locationChange:function(){this.render()},render:function(){var e=this;e.setViewPagelet({pics:[]},function(){e.components()})},components:function(){},picPreview:function(e){for(var t=this,a=t.getManaged("pagelet"),n=e.length,i=[],o=0;n>o;o++){var r=e[o],d={};if(r){d.fileSize=r.size>1048576?(Math.round(100*r.size/1048576)/100).toString()+"MB":(Math.round(100*r.size/1024)/100).toString()+"KB"}if(0==r.type.indexOf("image")){var l=new FileReader;l.readAsDataURL(r),function(e,t){l.onload=function(o){e.filePath=o.target.result,i.push(e),t==n-1&&a.setChunkData("pics",i)}}(d,o)}}},uploadFile:function(e){function t(){if(u<e.length&&u!=e.length){var t=new FormData;t.append("author","Shiv Kumar"),t.append("name","Html 5 File API/FormData"),t.append("pic",e[u]);var r=new XMLHttpRequest;r.upload.addEventListener("progress",a,!1),r.addEventListener("load",n,!1),r.addEventListener("error",i,!1),r.addEventListener("abort",o,!1),r.open("POST","/manage/pictureAdd"),r.send(t)}}function a(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total),a=d(".progress"+u);a.html('<div style="width:'+t.toString()+'%;"></div>')}}function n(){u++,t(),u==e.length&&(r.hideDialog(),l.getManaged("data").callback())}function i(){}function o(){}var l=this,u=(l.getManaged("pagelet"),0);t()},"fileChange<change>":function(e){e.halt();var t=this,a=d("#J_upload")[0].files;t.picPreview(a)},"upload<click>":function(e){e.halt();var t=this,a=d("#J_upload")[0].files;t.uploadFile(a)},"cancel<click>":function(){r.hideDialog()}})},{requires:["mxext/view","app/models/modelmanager","magix/vom","magix/router","node","app/util/util"]});