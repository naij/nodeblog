KISSY.add("app/util/dialog/dialog",function(e,t,i,o){var n,a,d=e.all,r={},l=function(e){27===e.keyCode&&r.hideDialog()};return e.mix(r,{showDialog:function(r,c,u){function f(){i.remove(s),a&&a.view&&(a.unmountView(),a=null),n.detach(),n.destroy(),n=null}var s="vf-dialog",g={mask:!0,zIndex:9998,duration:.25,easing:"easeOut",width:500,tmpl:'<vframe id="'+s+'"></vframe>',closable:!0},h=e.merge(g,r);if(h.start=h.start||{},h.end=h.end||{},h.direction){var w=e.all(h.direction.node);w=w.length>0?w:e.all("body");var v=w.offset(),m=w.width(),p=e.DOM.docWidth(),y=h.direction.value||"left";switch(y){case"left":h.start.left=-h.width,h.end.left=v.left;break;case"right":h.start.left=p,h.end.left=m+v.left-h.width}if(void 0===h.start.top&&void 0===h.end.top){var x=e.one(window).scrollTop();h.start.top=h.end.top=x+5}}return n&&f(),n=new o(h),n.on("afterRenderUI",function(){a=new t(s),i.add(a),a&&c&&(a.mountView(c,u),a.on("created",function(){var e,t=n.get("el").outerHeight(),i=d(window).scrollTop(),o=d(window).innerHeight();!h.direction||"left"!=h.direction.value&&"right"!=h.direction.value||h.end.top+t>i+o&&(e=i+o-t,setTimeout(function(){n.get("el").animate({top:e},.25,"easeNone")},300))}))}),n.render(),n.show(),n.on("hide",function(){f()}),h.closable&&e.all(document).on("keydown",l),n},hideDialog:function(t){n&&(n.on("hide",function(){t&&t()}),n.hide(),e.all(document).detach("keydown",l))},getDefaultDialogConfig:function(e){var t={start:{top:e.top,opacity:0},end:{top:e.top,opacity:1},direction:{node:d(".main"),value:e.direction||"right"},width:e.width||600};return t}}),r},{requires:["magix/vframe","magix/vom","brix/gallery/dialog/index"]});